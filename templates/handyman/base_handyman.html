{% load l10n %}



<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tratra - Plateforme de Services</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@700;800&display=swap"
          rel="stylesheet">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>

    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    {#<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>#}
    <!-- JQUERY D'ABORD -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet">

    <!-- ENSUITE SELECT2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Couleurs harmonisées avec la landing page
                        primary: '#2e8b57',     // Vert forêt
                        secondary: '#3cb371',   // Vert moyen
                        accent: '#90ee90',      // Vert clair
                        worker: '#2e8b57',      // Utilisation du vert forêt pour les travailleurs
                        employer: '#3cb371',    // Utilisation du vert moyen pour les employeurs
                        dark: '#1a1a1a',
                        light: '#f8fafc',
                        ivory: '#fffff0',
                        gold: '#FFD700',
                        success: '#10b981'      // Vert de succès
                    },
                    boxShadow: {
                        'card': '0 20px 40px -15px rgba(0, 0, 0, 0.1)',
                        'glow': '0 0 25px rgba(46, 139, 87, 0.25)', // Vert forêt
                        'inner-xl': 'inset 0 10px 20px rgba(0,0,0,0.05)'
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'bounce-slow': 'bounceSlow 3s infinite',
                        'wave': 'wave 8s linear infinite',
                        'progress': 'progressBar 3s ease-in-out forwards'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': {transform: 'translateY(0)'},
                            '50%': {transform: 'translateY(-12px)'}
                        },
                        fadeIn: {
                            '0%': {opacity: 0, transform: 'translateY(20px)'},
                            '100%': {opacity: 1, transform: 'translateY(0)'}
                        },
                        bounceSlow: {
                            '0%, 100%': {
                                transform: 'translateY(0)',
                                animationTimingFunction: 'cubic-bezier(0.8,0,1,1)'
                            },
                            '50%': {transform: 'translateY(-15px)', animationTimingFunction: 'cubic-bezier(0,0,0.2,1)'}
                        },
                        wave: {
                            '0%': {transform: 'translateX(0)'},
                            '100%': {transform: 'translateX(-100%)'}
                        },
                        progressBar: {
                            '0%': {width: '0%'},
                            '100%': {width: 'var(--progress-value)'}
                        }
                    }
                }
            }
        }
    </script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        :root {
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: #334155;
            overflow-x: hidden;
        }

        .header-worker {
            background: linear-gradient(120deg, #2e8b57 0%, #3cb371 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(46, 139, 87, 0.3);
            position: relative;
        {#overflow: hidden;#}{#z-index: 1000;#}

        }

        .header-worker::before {
            content: "";
            position: absolute;
            top: -100%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 70%);
            transform: rotate(30deg);
            animation: wave 20s linear infinite;

        }

        .header-employer {
            background: linear-gradient(120deg, #3cb371 0%, #2e8b57 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(60, 179, 113, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header-employer::before {
            content: "";
            position: absolute;
            top: -100%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 70%);
            transform: rotate(30deg);
            animation: wave 20s linear infinite;
        }

        .stats-card {
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(226, 232, 240, 0.5);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            background: white;
        }

        .stats-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        .stats-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--gradient-from), var(--gradient-to));
        }

        .service-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 16px;
            overflow: hidden;
            background: white;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .service-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.15);
        }

        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            position: relative;
        }

        .tab-button.active {
            border-bottom-color: currentColor;
            color: #2e8b57;
        }

        .tab-button.active::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: currentColor;
            animation: pulse-slow 2s infinite;
        }

        .switch-view {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            background: white;
            border-radius: 50px;
            padding: 10px 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: flex;
            gap: 10px;
            animation: fade-in 0.8s ease-out;
        }

        .progress-bar {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            background-color: #e2e8f0;
        }

        .progress-value {
            height: 100%;
            border-radius: 4px;
            animation: progress 1.5s ease-out forwards;
        }

        .notification-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            animation: bounceSlow 1.5s infinite;
        }

        .chart-container {
            height: 120px;
            display: flex;
            align-items: flex-end;
            gap: 8px;
            padding: 0 10px;
        }

        .chart-bar {
            width: 20px;
            background: linear-gradient(to top, var(--bar-color), var(--bar-color-light));
            border-radius: 4px 4px 0 0;
            animation: growBar 1s ease-out forwards;
        }

        @keyframes growBar {
            from {
                height: 0;
            }
            to {
                height: var(--bar-height);
            }
        }

        .floating {
            animation: float 6s ease-in-out infinite;
        }

        .bounce {
            animation: bounceSlow 3s infinite;
        }

        .pulse {
            animation: pulse-slow 3s infinite;
        }

        .calendar-day {
            transition: all 0.3s ease;
            border-radius: 8px;
            cursor: pointer;
        }

        .calendar-day:hover {
            transform: scale(1.1);
            background-color: #f1f5f9;
        }

        .calendar-day.active {
            background: linear-gradient(135deg, #2e8b57, #3cb371);
            color: white;
            box-shadow: 0 4px 10px rgba(46, 139, 87, 0.3);
        }

        .calendar-day.booked {
            background: linear-gradient(135deg, #3cb371, #2e8b57);
            color: white;
        }

        .calendar-day.available {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .rating-stars {
            position: relative;
            display: inline-block;
        }

        .rating-stars::before {
            content: "★★★★★";
            color: #cbd5e1;
        }

        .rating-fill {
            position: absolute;
            top: 0;
            left: 0;
            white-space: nowrap;
            overflow: hidden;
            width: var(--rating-width);
        }

        .rating-fill::before {
            content: "★★★★★";
            color: #f59e0b;
        }

        /* Ajout d'éléments décoratifs inspirés de la landing page */
        .tratra-logo {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .tratra-logo .logo-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2e8b57;
            display: inline-block;
        }

        .tratra-logo .logo-icon:nth-child(2) {
            background: #3cb371;
        }

        .tratra-logo .logo-icon:nth-child(3) {
            background: #90ee90;
        }

        .floating-dots {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            z-index: 0;
        }

        .floating-dots.primary {
            background: rgba(46, 139, 87, 0.2);
        }

        .floating-dots.secondary {
            background: rgba(60, 179, 113, 0.2);
        }

        .floating-dots.accent {
            background: rgba(144, 238, 144, 0.2);
        }
    </style>
</head>

<body class="min-h-screen flex flex-col"
      x-data="{ 
          currentView: 'worker',
          sidebarOpen: window.innerWidth > 1024,
          mobileMenuOpen: false,
          notifications: [
            { id: 1, title: 'Nouvelle réservation', description: 'Mariage Kouassi confirmé pour demain', time: 'Il y a 2 min', read: false, icon: 'fas fa-calendar-check', color: 'bg-primary' },
            { id: 2, title: 'Paiement reçu', description: '450.000 FCFA pour service de cuisine', time: 'Il y a 1h', read: false, icon: 'fas fa-wallet', color: 'bg-secondary' },
            { id: 3, title: 'Avis reçu', description: 'Nouvel avis 5 étoiles de Fatoumata', time: 'Il y a 3h', read: true, icon: 'fas fa-star', color: 'bg-yellow-500' }
          ],
          unreadCount: 2,
          activeTab: 'upcoming',
          selectedDate: new Date(),
          availability: {
            '2023-07-05': 'available',
            '2023-07-08': 'available',
            '2023-07-12': 'booked',
            '2023-07-15': 'booked',
            '2023-07-18': 'available',
            '2023-07-22': 'available'
          },
          workerServices: [
            { id: 1, title: 'Service de cuisine', category: 'Cuisine', price: '50.000 FCFA', rating: 4.9, missions: 24, image: 'https://source.unsplash.com/random/600x400/?cooking,chef' },
            { id: 2, title: 'Service de chauffeur', category: 'Transport', price: '30.000 FCFA', rating: 4.7, missions: 18, image: 'https://source.unsplash.com/random/600x400/?driver,car' },
            { id: 3, title: 'Nettoyage premium', category: 'Ménage', price: '25.000 FCFA', rating: 4.8, missions: 15, image: 'https://source.unsplash.com/random/600x400/?cleaning,house' }
          ],
          recommendedWorkers: [
            { id: 1, name: 'Amara Diallo', profession: 'Cuisinier Professionnel', price: '50.000 FCFA', rating: 4.9, image: 'https://source.unsplash.com/random/600x400/?chef,man' },
            { id: 2, name: 'Mohamed Traoré', profession: 'Chauffeur Privé', price: '35.000 FCFA', rating: 4.8, image: 'https://source.unsplash.com/random/600x400/?driver,man' },
            { id: 3, name: 'Aïcha Koné', profession: 'Nounou Expérimentée', price: '40.000 FCFA', rating: 4.7, image: 'https://source.unsplash.com/random/600x400/?nanny,woman' },
            { id: 4, name: 'Jean Kouassi', profession: 'Jardinier Paysagiste', price: '25.000 FCFA', rating: 4.8, image: 'https://source.unsplash.com/random/600x400/?gardener,man' }
          ],
          activeRequests: [
            { id: 1, title: 'Cuisinier pour dîner d\'affaires', date: '12 Juin 2023', providers: 3, status: 'En cours', icon: 'fas fa-utensils' },
            { id: 2, title: 'Transport aéroport', date: '11 Juin 2023', providers: 5, status: 'En cours', icon: 'fas fa-car' }
          ],
          upcomingServices: [
            { id: 1, title: 'Nettoyage mensuel', provider: 'Fatoumata Diallo', date: 'Demain, 10h - 13h', status: 'Confirmé', icon: 'fas fa-concierge-bell' },
            { id: 2, title: 'Garde d\'enfants', provider: 'Aïcha Koné', date: 'Samedi, 14h - 20h', status: 'Confirmé', icon: 'fas fa-baby' }
          ]
      }"
      x-init="
        $nextTick(() => {
          // Initialize charts
          document.querySelectorAll('.chart-bar').forEach(bar => {
            bar.style.setProperty('--bar-height', bar.getAttribute('data-height') + 'px');
          });
          
          // Initialize rating stars
          document.querySelectorAll('.rating-stars').forEach(stars => {
            const rating = parseFloat(stars.getAttribute('data-rating'));
            const width = (rating / 5) * 100;
            stars.style.setProperty('--rating-width', width + '%');
          });
        });
      ">


<!-- Worker View -->
<template x-if="currentView === 'worker'">
    <div>
        <!-- Worker Header -->
        {% include 'handyman/header.html' %}

        <!-- Worker Content -->
        {% block content %}
        {% endblock %}
    </div>
</template>
<script>
    // Initialize animations on page load
    document.addEventListener('DOMContentLoaded', function () {
        // Add animation to all elements with specific classes
        document.querySelectorAll('.floating').forEach(el => {
            el.style.animation = 'float 6s ease-in-out infinite';
        });

        document.querySelectorAll('.bounce').forEach(el => {
            el.style.animation = 'bounceSlow 3s infinite';
        });

        document.querySelectorAll('.pulse').forEach(el => {
            el.style.animation = 'pulse-slow 3s infinite';
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        $('.select2-multiple').select2({
            placeholder: $(this).data('placeholder'),
            allowClear: true,
            width: '100%',
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/locales/fr.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialiser le calendrier
        const calendarEl = document.getElementById('calendar');
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            locale: 'fr',
            firstDay: 1, // Lundi comme premier jour
            events: JSON.parse('{{ bookings|escapejs }}').concat(JSON.parse('{{ availability|escapejs }}')),
            eventClick: function(info) {
                if (info.event.extendedProps.type !== 'availability') {
                    showBookingDetails(info.event);
                }
            },
            eventDidMount: function(info) {
                if (info.event.extendedProps.type === 'availability') {
                    info.el.classList.add('fc-event-availability');
                }
            },
            datesSet: function(info) {
                updateBookingStats(info.start, info.end);
            }
        });
        
        calendar.render();
        
        // Afficher les détails d'une réservation
        function showBookingDetails(event) {
            const extendedProps = event.extendedProps;
            const startDate = new Date(event.start);
            const endDate = event.end ? new Date(event.end) : null;
            
            const detailsHtml = `
                <div class="booking-details-card border-l-4" style="border-color: ${event.backgroundColor}">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-bold text-gray-800">${event.title}</h3>
                            <span class="status-badge" style="background-color: ${event.backgroundColor}; color: white">
                                ${extendedProps.status}
                            </span>
                        </div>
                        
                        <div class="mb-4">
                            <div class="flex items-center text-gray-600 mb-1">
                                <i class="far fa-calendar mr-2"></i>
                                ${startDate.toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </div>
                            <div class="flex items-center text-gray-600">
                                <i class="far fa-clock mr-2"></i>
                                ${startDate.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })} 
                                ${endDate ? ' - ' + endDate.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }) : ''}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="flex items-center text-gray-600 mb-2">
                                <i class="fas fa-user mr-2"></i>
                                <span class="font-medium">Client:</span> ${extendedProps.client}
                            </div>
                            <div class="flex items-start text-gray-600">
                                <i class="fas fa-map-marker-alt mt-1 mr-2"></i>
                                <span>${extendedProps.address}</span>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-gray-700">${extendedProps.description}</p>
                        </div>
                        
                        <div class="flex space-x-3">
                            <a href="/bookings/${event.id}/" class="flex-1 text-center px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm">
                                <i class="fas fa-eye mr-1"></i> Détails
                            </a>
                            <button class="px-3 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 transition text-sm">
                                <i class="fas fa-edit mr-1"></i> Modifier
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('booking-details').innerHTML = detailsHtml;
        }
        
        // Mettre à jour les statistiques
        function updateBookingStats(start, end) {
            // Compter les réservations dans la période visible
            const events = calendar.getEvents();
            let confirmed = 0, completed = 0, pending = 0;
            
            events.forEach(event => {
                if (event.extendedProps.type !== 'availability') {
                    const eventStart = event.start;
                    if (eventStart >= start && eventStart <= end) {
                        if (event.extendedProps.status === "Confirmé") confirmed++;
                        if (event.extendedProps.status === "Terminé") completed++;
                        if (event.extendedProps.status === "En attente") pending++;
                    }
                }
            });
            
            document.getElementById('confirmed-count').textContent = confirmed;
            document.getElementById('completed-count').textContent = completed;
            document.getElementById('pending-count').textContent = pending;
            document.getElementById('total-count').textContent = confirmed + completed + pending;
        }
        
        // Initialiser les statistiques
        const initialStart = new Date('{{ today|escapejs }}');
        const initialEnd = new Date(initialStart);
        initialEnd.setMonth(initialEnd.getMonth() + 1);
        updateBookingStats(initialStart, initialEnd);
    });
</script>
</body>
</html>
